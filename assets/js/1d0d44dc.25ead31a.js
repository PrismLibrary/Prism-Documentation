"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[9923],{2776:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"dependency-injection/add-custom-container","title":"Custom Containers","description":"For a variety of reasons the Prism team cannot support every container that developers may want to use. Prism makes it very easy to use a container that isn\'t officially supported or shipped by the Prism Library.","source":"@site/versioned_docs/version-9.0/dependency-injection/add-custom-container.md","sourceDirName":"dependency-injection","slug":"/dependency-injection/add-custom-container","permalink":"/docs/9.0/dependency-injection/add-custom-container","draft":false,"unlisted":false,"editUrl":"https://github.com/PrismLibrary/Prism-Documentation/edit/master/versioned_docs/version-9.0/dependency-injection/add-custom-container.md","tags":[],"version":"9.0","lastUpdatedBy":"Dan Siegel","lastUpdatedAt":1763924282000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"Prism Container Extensions","permalink":"/docs/9.0/dependency-injection/appendix"},"next":{"title":"Getting Started","permalink":"/docs/9.0/dialogs/"}}');var o=t(4848),s=t(8453);const r={sidebar_position:8},a="Custom Containers",c={},d=[{value:"Create a New Project",id:"create-a-new-project",level:2},{value:"Adding a Container Extension",id:"adding-a-container-extension",level:2},{value:"Create the Application Class",id:"create-the-application-class",level:2}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"custom-containers",children:"Custom Containers"})}),"\n",(0,o.jsx)(n.p,{children:"For a variety of reasons the Prism team cannot support every container that developers may want to use. Prism makes it very easy to use a container that isn't officially supported or shipped by the Prism Library."}),"\n",(0,o.jsx)(n.p,{children:"Prism imposes the following requirements in order to use a container:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The container must be mutable to support Prism Modularity"}),"\n",(0,o.jsx)(n.li,{children:"The container must support Transient and Singleton registrations"}),"\n",(0,o.jsx)(n.li,{children:"The container must support registering a specified instance"}),"\n",(0,o.jsx)(n.li,{children:"The container must support keyed registrations / resolving by name"}),"\n",(0,o.jsx)(n.li,{children:"The container must support accessing its service registrations"}),"\n",(0,o.jsx)(n.li,{children:"The container must support all Prism platforms (WPF, .NET MAUI, Uno Platform)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"In this topic we will be creating a container extension for the Grace DI container."}),"\n",(0,o.jsx)(n.h2,{id:"create-a-new-project",children:"Create a New Project"}),"\n",(0,o.jsx)(n.p,{children:"The first step is to create a new project that will contain the code for your DI container extension."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"dotnet new classlib\n"})}),"\n",(0,o.jsx)(n.p,{children:"Next you'll want to add a Reference to the Prism.Core and your container of choice"}),"\n",(0,o.jsx)(n.h2,{id:"adding-a-container-extension",children:"Adding a Container Extension"}),"\n",(0,o.jsxs)(n.p,{children:["Next, add a new class to your project and implement the ",(0,o.jsx)(n.code,{children:"IContainerExtension"})," interface.  The ",(0,o.jsx)(n.code,{children:"IContainerExtension"})," interface is used to create a mapping for the most common registration and resolution methods."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"The implementation shown here is not maintained. Note that there are differences in the Prism 8 Ioc abstractions from what is shown here, and there may additionally be changes in the GraceIoc API. This is provided only as an example."})}),"\n",(0,o.jsx)(n.p,{children:"In the case of the Grace DI container we simply need to add this single class:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"public class GraceContainerExtension : IContainerExtension<IInjectionScope>\n{\n    public GraceContainerExtension()\n        : this(new DependencyInjectionContainer())\n    {\n    }\n\n    public GraceContainerExtension(IInjectionScope injectionScope)\n    {\n        Instance = injectionScope;\n    }\n\n    public IInjectionScope Instance { get; }\n\n    public void FinalizeExtension() { }\n\n    public IContainerRegistry Register(Type from, Type to)\n    {\n        Instance.Configure(c => c.Export(to).As(from));\n        return this;\n    }\n\n    public IContainerRegistry Register(Type from, Type to, string name)\n    {\n        Instance.Configure(c => c.Export(to).AsKeyed(from, name));\n        return this;\n    }\n\n    public IContainerRegistry RegisterInstance(Type type, object instance)\n    {\n        Instance.Configure(c => c.ExportInstance(instance).As(type));\n        return this;\n    }\n\n    public IContainerRegistry RegisterSingleton(Type from, Type to) =>\n        Instance.Configure(c => c.Export(to).As(from).Lifestyle.Singleton());\n\n    // NOTE: ContainerResolutionException is v8.0+\n    public object Resolve(Type type)\n    {\n        try\n        {\n            return Instance.Locate(type);\n        }\n        catch(Exception ex)\n        {\n            throw new ContainerResolutionException(ex);\n        }\n    }\n\n    // NOTE: ContainerResolutionException is v8.0+\n    public object Resolve(Type type, string name)\n    {\n        try\n        {\n            return Instance.Locate(type, withKey: name);\n        }\n        catch(Exception ex)\n        {\n            throw new ContainerResolutionException(ex);\n        }\n    }\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["If using Prism 8+ you will need to additionally implement ",(0,o.jsx)(n.code,{children:"IContainerInfo"}),", and your Resolve methods should catch any exception thrown by the container and rethrow using the Prism ContainerResolutionException."]})}),"\n",(0,o.jsx)(n.h2,{id:"create-the-application-class",children:"Create the Application Class"}),"\n",(0,o.jsx)(n.p,{children:"Once we've added this single class we only need to add to update our App as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"namespace Prism.Grace\n{\n    public partial class PrismApplication : PrismApplicationBase\n    {\n        protected override IContainerExtension CreateContainerExtension() => new GraceContainerExtension();\n    }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"As previously mentioned, Prism's IOC abstraction only provides the most common functionality. This means that you could find an advanced scenario where you need direct access to the underlying container. To achieve a more complex registration, you can add an extension method like we provide in the Container specific packages:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"public static class ContainerExtensions\n{\n    public static IInjectionScope GetContainer(this IContainerRegistry containerRegistry) =>\n        ((IContainerExtension<IInjectionScope>)containerRegistry).Instance;\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);