"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5327],{718:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"dependency-injection/container-locator","title":"The ContainerLocator","description":"The ContainerLocator is new in Prism 8.0. This was introduced to help Prism get rid of a dependency on the CommonServiceLocator, and solve a number of internal issues where we must fallback to a ServiceLocator pattern such as within XAML Extensions.","source":"@site/docs/dependency-injection/container-locator.md","sourceDirName":"dependency-injection","slug":"/dependency-injection/container-locator","permalink":"/docs/current/dependency-injection/container-locator","draft":false,"unlisted":false,"editUrl":"https://github.com/PrismLibrary/Prism-Documentation/edit/master/docs/dependency-injection/container-locator.md","tags":[],"version":"current","lastUpdatedBy":"Dan Siegel","lastUpdatedAt":1763924282000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Handling Resolution Errors","permalink":"/docs/current/dependency-injection/resolution-errors"},"next":{"title":"Prism Container Extensions","permalink":"/docs/current/dependency-injection/appendix"}}');var i=t(4848),r=t(8453);const a={sidebar_position:6},s="The ContainerLocator",c={},l=[{value:"How to use the ContainerLocator",id:"how-to-use-the-containerlocator",level:2},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Testing",id:"testing",level:3},{value:"Example Usage",id:"example-usage",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"the-containerlocator",children:"The ContainerLocator"})}),"\n",(0,i.jsx)(n.p,{children:"The ContainerLocator is new in Prism 8.0. This was introduced to help Prism get rid of a dependency on the CommonServiceLocator, and solve a number of internal issues where we must fallback to a ServiceLocator pattern such as within XAML Extensions."}),"\n",(0,i.jsx)(n.p,{children:"The ContainerLocator also has some additional benefits for Prism, particularly for those developers working on Cross Platform applications such as .NET MAUI or Uno Platform. In these cases it may sometimes be necessary to initialize the container prior to initializing your Prism application. A common example of this would be apps that are leveraging Shiny. For such apps you may want to add the ServiceCollection to your Prism container and then return the ServiceProvider to Shiny. This allows both Prism and Shiny to maintain a single container rather than have multiple containers."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For those developers sponsoring ",(0,i.jsx)(n.a,{href:"https://xam.dev/sponsor-prism-dan",children:"Dan Siegel"})," it is recommended that you use the Prism.Magician for this."]})}),"\n",(0,i.jsx)(n.h2,{id:"how-to-use-the-containerlocator",children:"How to use the ContainerLocator"}),"\n",(0,i.jsx)(n.p,{children:"Note that the ContainerLocator can set the container instance lazily by taking a delegate to create the container. It will NOT create the container until ContainerLocator.Container is called."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"var createContainerExtension = () => new DryIocContainerExtension();\nContainerLocator.SetContainerExtension(createContainerExtension);\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If you do not call ",(0,i.jsx)(n.code,{children:"ContainerLocator.Current"})," or ",(0,i.jsx)(n.code,{children:"ContainerLocator.Container"})," after setting the creation delegate, subsequent calls to ",(0,i.jsx)(n.code,{children:"SetContainerExtension"})," will override your initial delegate."]})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,i.jsx)(n.p,{children:"Please note that the information here is for advanced users only. These API's are intentionally hidden from intellisense because they are not for common consumption. Use these at your own risk, and only under the right circumstances."}),"\n",(0,i.jsxs)(n.p,{children:["In the event that you need to access the raw IContainerExtension you can do so by accessing ",(0,i.jsx)(n.code,{children:"ContainerLocator.Current"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"While not entirely an uncommon issue, while unit testing it is commonly recommended that you reset the ContainerLocator. This ensures container is disposed and that the container instance is cleared along with the delegate to create a new instance."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public class SomeTests : IDisposable\n{\n    public void Dispose()\n    {\n        ContainerLocator.ResetContainer();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,i.jsx)(n.p,{children:"In a ShinyStartup you might have something like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public class MyStartup : ShinyStartup\n{\n    private void RegisterTypes(IContainerRegistry container)\n    {\n        // Your normal registrations here...\n    }\n\n    private IContainerExtension CreateContainerExtension() =>\n        new DryIocContainerExtension();\n\n    public override IServiceProvider CreateServiceProvider(IServiceCollection services)\n    {\n        ContainerLocator.SetContainerExtension(CreateContainerExtension);\n        var container = ContainerLocator.Container;\n        container.RegisterServices(services);\n        RegisterTypes(container);\n        return container.GetContainer();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"In a XAML Extension"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public class SomeMarkupExtension : IMarkupExtension\n{\n    private static readonly Lazy<IEventAggregator> _lazyEventAggregator =\n        new Lazy<IEventAggregator>(() => ContainerLocator.Container.Resolve<IEventAggregator>());\n\n    private IEventAggregator EventAggregator => _lazyEventAggregator.Value;\n\n    public object ProvideValue(IServiceProvider provider)\n    {\n        // your logic here...\n    }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var o=t(6540);const i={},r=o.createContext(i);function a(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);